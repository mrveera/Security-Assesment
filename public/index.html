<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Quiz json creator</title>
    <script src="js/question.js" charset="utf-8"></script>
    <script src="js/section.js" charset="utf-8"></script>
    <script src="js/sectionLoader.js" charset="utf-8"></script>
    <script src="js/tsvToJSON.js" charset="utf-8"></script>
    <script src="js/quiz.js" charset="utf-8"></script>
    <script type="text/javascript">
      let getFormat=function(event){
        format=document.getElementById('quizFormat').value;
        document.getElementById('quizFormat').style.display="none";
        event.target.style.display="none";
        document.getElementById('res').style.display="block";
      }
      let submitResponse = function (response) {
        let projectName=response.projectName[0];
        let quiz=new Quiz(projectName,10,format);
        Object.keys(response).forEach(k=>quiz.addAnswers(k,response[k]));
        return quiz;
      }
      let showResults= function () {
        let responses=document.getElementById('resText').value;
        responses=tsvToJSON(responses);
        let formattedRes=responses.reduce((prev,cur)=>{
          prev[cur.projectName[0]]=submitResponse(cur);
          return prev;
        },{})
        displayResult(formattedRes);
      }
      let displayResult=function (res) {
        let projects=Object.keys(res);
        let html =projects.map(p=>{
          return `<p>${res[p].name} ${res[p].getTotalScores()}</p>`;
        }).join('<br>');
        document.getElementById('formattedRes').innerHTML=html;
      }
    </script>
  </head>
  <body id="text">
    <div class="" id="formattedRes">

    </div>
    <div class="" id="quiz">
      <textarea type="text" id="quizFormat" value="" cols="80" rows="10"></textarea>
      <button type="button" name="button" onclick="getFormat(event)">parse</button>
    </div>
    <div class="" id="res" style="display:none">
      <textarea type="text" id="resText" value="" cols="80" rows="10"></textarea>
      <button type="button" name="button" onclick="showResults()">showResults</button>
    </div>

  </body>
</html>
